<!DOCTYPE html>
<html lang="ja">
  
  <head>
    <meta charset="UTF-8">
    <title>ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ãƒšãƒ¼ã‚¸</title>
  </head>

  <body>
    <style>
      .parent {
        background-color: #edebeb;
        width: 80%;
        height: 150px;
        margin-top: 2%;
        margin-left: auto;
        margin-right: auto;
      }
      textarea {
        width: 100%; 
        box-sizing: border-box;  /* â€»ã“ã‚ŒãŒãªã„ã¨æ¨ªã«ã¯ã¿å‡ºã‚‹ */
        height:130px; 
        font-size: large;
        outline: none;           /* â€»ãƒ–ãƒ©ã‚¦ã‚¶ãŒæ¨™æº–ã§ä»˜åŠ ã™ã‚‹ç·šã‚’æ¶ˆã—ãŸã„ã¨ã */
        resize: none;
      }
      .box16{
          background: -webkit-repeating-linear-gradient(-45deg, #f0f8ff, #f0f8ff 3px,#e9f4ff 3px, #e9f4ff 7px);
          background: repeating-linear-gradient(-45deg, #f0f8ff, #f0f8ff 3px,#e9f4ff 3px, #e9f4ff 7px);
      }
      .box18{
        color: #565656;
        background: #fcf4d6;
        border: dashed 2px #f9ce31;
      }
      .box24 {
          position: relative;
          padding: 0.5em 0.7em;
          margin: 2em 0;
          background: #6f4b3e;
          color: white;
          font-weight: bold;
      }
      .button02 {
        width: 300px;
        color: #333;
        font-weight: 700;
        background-color: #cccccc;
        border-radius: 50vh;
      }
      .btn_area{
        display: block;
        width: 110px;
        margin: 0 auto;
      }
      button[type="button"]{
        background-color: #2882c2;
        border: 3px solid #2882c2;
        box-shadow: 0 1px 4px rgba(0, 0, 0, .2);
        color: #fff;
        font-size:15px;
        font-weight:bold;
        padding: 10px 20px;
        margin: 0 auto;
        margin-top: 30%;
        border-radius: 10px;
        cursor: pointer;
      }
      button[type="button"]:hover {
        color: #2882c2;
        background-color: #fff;
      }
    </style>
    <!-- <label>Student ID</label><input id="name"/>
    <span class="button02" id="ok">Ready</span> -->
    <div>
      <p style="text-align: center; margin-top: 7%;">
        å·¦å´ã®é»„è‰²æ å†…ã¯ãŠæ‰‹æœ¬ç”¨ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚å³å´ã®æ°´è‰²æ å†…ã«ã€ãŠæ‰‹æœ¬ã¨åŒã˜ã‚³ãƒ¼ãƒ‰ã‚’ã‚¿ã‚¤ãƒ—ã—ã¦ãã ã•ã„ï¼<br>
        5è¡Œå…¨ã¦ã®å†…å®¹ã‚’ã‚¿ã‚¤ãƒ—çµ‚äº†å¾Œã€é€ä¿¡ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
        â€»ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆã—ãŸã‚‚ã®ã¯ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã›ã‚“ã€‚
      </p>
    </div>
    <div class="parent">
      <div style="float: left; width: 50%; text-align: right;">
        <label class="box24" for="outout">Code</label>
        <textarea id="output" class="box18 python" readonly>
print(math.sin(math.pi/2))
print(["oranges", "tables"])
print(weight / (height * height))
print(x if x >= y else y)
print(s[0].upper() for s in "abcdefg")
        </textarea>
      </div>
      <div style="float: left; width: 50%; text-align: right; ">
        <label class="box24" for="input">Type In</label>
        <textarea id="input" class="box16" placeholder="ã“ã“ã«æ‰“ã¡è¾¼ã‚“ã§ãã ã•ã„"></textarea>
      </div>
      <br>
      <br>
      <div class="btn_area" id="submit-button">
        <button id="submit-button" type="button">é€ä¿¡ã™ã‚‹</button>
        <!-- <button id="submit-button" type="button" onclick="location.href='radio.html'">å…¥åŠ›å†…å®¹ã‚’é€ä¿¡ã™ã‚‹</button> -->
      </div>
    </div>
    <script src="https://unpkg.com/uuid@latest/dist/umd/uuidv4.min.js"></script>
    <script type="text/javascript" src="./logger.js"></script>
    <script type="text/javascript">
      let SESSION = String(uuidv4());
      let timer = null;
      let buffers = [];
      let time = [];
      let dict = {};
      let result = new Object();
      let idPane = null;

      // ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã®uuidã¨ç´ä»˜ã‘
      if ( localStorage.getItem('uuid') ){ 
        idPane = localStorage.getItem('uuid');
        console.log(idPane)
        // const idPane = document.getElementById('name');
      } else {
        idPane = String(uuidv4());
      }

      // const idPane = document.getElementById('name');
      const inputPane = document.getElementById('input');
      let submitted = false;

      let buttonClick = () => {
        // result.uid = idPane.value;
        result.uid = idPane;
        result.code = inputPane.value;
        result.counts = dict;
        result.keys = buffers.join(' ');
        result.browser = window.navigator.userAgent;
        result.type = "typing_guest";
        
        let mean_time = _time();
        result.time = mean_time;
        // document.getElementById('ok').innerText = `é€ä¿¡ã—ã¾ã—ãŸã€‚\n å¹³å‡: ${mean_time}ms`; //, æ­£ç¢ºã•: ${data.acc}
        
        console.log(result);

        record_login();
        result = new Object();

        alert(`ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã«ã‹ã‹ã£ãŸå¹³å‡æ™‚é–“ã¯ã€${mean_time}ms ã§ã™ã€‚\nã”å”åŠ›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼`);
        localStorage.removeItem('uuid');
        location.href = 'https://artms007.github.io/key/guest/quest.html';
      };

      let before = new Date().getTime();

      inputPane.addEventListener('keydown', (e) => {
        let now = new Date().getTime();
        let diff = now - before;
        if(buffers.length != 0) {
          time.push(diff)
        }
        if(e.key === ' ') {
            buffers.push(`${diff} SPACE`);
        }
        else {
            buffers.push(`${diff} ${e.key}`);
        }

        before = now;
        dict[e.key] = (dict[e.key] || 0) + 1;
        console.log(`buffers :${buffers}`);

        let size = inputPane.value.length;
        // è‡ªå‹•ã§é€ä¿¡ç”¨
        // if(size > 10 && dict[')'] >= 8 && dict['i'] >= 10 && dict['t'] >= 10 && dict['g'] >= 5) {
        //     if(!submitted) {
        //         submitted = true;
        //         // document.getElementById('ok').innerText = 'å‡ºå¸­';
        //         setTimeout(buttonClick, 3500);
        //     }
        // }
        // else{
        //     document.getElementById('ok').innerText = `${size}`;
        // }
        
        // ãƒœã‚¿ãƒ³ã§é€ä¿¡ç”¨
        document.getElementById("submit-button").onclick = function() {
          if(size > 10 && dict[')'] >= 8 && dict['i'] >= 10 && dict['t'] >= 10 && dict['g'] >= 5) {
            if(!submitted) {
                submitted = true;
                buttonClick();
                // document.getElementById('ok').innerText = 'å‡ºå¸­';
                // setTimeout(buttonClick, 3500);
            }
          }else{
            alert("âš ï¸é€ä¿¡ã•ã‚Œã¦ã„ã¾ã›ã‚“\næœ€å¾Œã®è¡Œã¾ã§ã®å…¥åŠ›ã«ã”å”åŠ›ãã ã•ã„ğŸ™‡â€â™€ï¸");
            
          }
          // else{
          //     document.getElementById('ok').innerText = `${size}`;
          // }
        };
      });
      
    </script> 
  </body>
</html>
